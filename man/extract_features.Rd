% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/extract_features.R
\name{extract_features}
\alias{extract_features}
\title{Extract Rab Spot Features from a Folder (Pure R Implementation)}
\usage{
extract_features(
  root_dir,
  min_spot_size = 8,
  neighbor_radius = 15,
  conditions = NULL,
  python_path = NULL,
  nucleus_folder = "nucleus_mask",
  cell_folder = "cell_mask",
  rab_folder = "rab5",
  spot_folder = "rab5_mask",
  n_jobs = NULL
)
}
\arguments{
\item{root_dir}{Character. Path to the root directory containing experimental condition folders.
Each condition folder should contain the subdirectories listed above.}

\item{min_spot_size}{Numeric. Minimum area (in pixels) for Rab spots to include.
Spots smaller than this are filtered out. Default is 8.}

\item{neighbor_radius}{Numeric. Radius (in pixels) for searching neighboring Rab spots.
Default is 15 pixels (considering typical endosome size ~500-1000 nm).}

\item{conditions}{Character vector. Specific experimental conditions to process.
If NULL, all folders in root_dir are processed. Default is NULL.}

\item{python_path}{Character. Path to a Python executable to use. If NULL the helper
`find_rabanalyser_python()` provisions and returns the package's
managed virtualenv interpreter. Only used when
`use_python = TRUE`.}

\item{nucleus_folder}{Character. Name of nucleus mask subfolder. Default "nucleus_mask".}

\item{cell_folder}{Character. Name of cell mask subfolder. Default "cell_mask".}

\item{rab_folder}{Character. Name of Rab signal subfolder. Default "rab5".}

\item{spot_folder}{Character. Name of spot mask subfolder. Default "rab5_mask".}

\item{n_jobs}{Integer. Number of parallel workers for image processing. If NULL,
uses `parallel::detectCores() - 2` (minimum 1). Set to 1 for
serial processing.}

\item{use_python}{Logical. If TRUE the Python backend will be used via \pkg{reticulate}
(a managed virtualenv is created on-demand). If FALSE the pure R
implementation is used. Default is FALSE.}
}
\value{
A list of data frames, one for each condition, containing extracted features:
  \describe{
    \item{cell_id}{ID of the cell analyzed}
    \item{area}{Area of Rab spot in pixels}
    \item{integral_intensity}{Sum of pixel intensities within spot}
    \item{mean_intensity}{Mean pixel intensity within spot}
    \item{circularity}{Shape circularity measure (0-1, where 1 is perfect circle)}
    \item{eccentricity}{Eccentricity of spot (0-1)}
    \item{elongation}{Ratio of major to minor axis}
    \item{dist_nucleus_centroid}{Distance from nucleus centroid (normalized by Feret's diameter)}
    \item{dist_nucleus_outline}{Distance from nucleus outline (normalized by Feret's diameter)}
    \item{dist_plasma_membrane}{Distance from cell plasma membrane (normalized by Feret's diameter)}
    \item{dist_nearest_spot}{Distance to nearest neighboring spot (normalized by Feret's diameter)}
    \item{num_neighbors}{Number of neighboring spots within radius}
  }
  Each data frame is also saved as an Excel file in the root_dir.
}
\description{
This function performs automated feature extraction from TIFF microscopy images
within a specified folder using pure R code. It processes nucleus masks, cell masks,
Rab raw signals, and spot masks to extract morphological and spatial features of Rab spots.
}
\details{
The function expects a folder structure with subdirectories:
\describe{
  \item{nucleus_mask/}{Folder containing nucleus mask TIFF images}
  \item{cell_mask/}{Folder containing cell mask TIFF images}
  \item{spots/}{Folder containing raw Rab signal TIFF images}
  \item{spot_mask/}{Folder containing Rab spot mask TIFF images}
}



When `use_python = TRUE`, \pkg{reticulate} is used to configure a dedicated
virtual environment (named `"rabanalyser-venv"` by default) based on the
dependency list in `inst/python/requirements.txt`, then calls the packaged
`feature_extraction_wrapper.py` module directly.

All distance measures are normalized by Feret's diameter (longest distance across
the cell's convex hull) for scale-invariant comparisons.
}
\examples{
\dontrun{
  # Process all conditions in a directory
  results <- extract_features("/path/to/data/folder")

  # Process specific conditions only
  results <- extract_features("/path/to/data/folder",
                              conditions = c("Control", "Treatment"))

  # Use custom parameters
  results <- extract_features(
    "/path/to/data/folder",
    min_spot_size = 10,
    neighbor_radius = 20
  )

  # Use custom folder names
  results <- extract_features(
    "/path/to/data/folder",
    nucleus_folder = "nucleus",
    cell_folder = "cell",
    rab_folder = "rab_signal",
    spot_folder = "rab_spots"
  )

  # Use parallel processing with 4 workers
  results <- extract_features(
    "/path/to/data/folder",
    n_jobs = 4
  )
}

}
