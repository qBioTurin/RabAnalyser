% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/extract_features.R
\name{extract_features}
\alias{extract_features}
\title{Extract Rab Spot Features from a Folder (Python Backend via processx)}
\usage{
extract_features(
  root_dir,
  min_spot_size = 8,
  neighbor_radius = 15,
  conditions = NULL,
  python_path = NULL,
  nucleus_folder = "nucleus_mask",
  cell_folder = "cell_mask",
  rab_folder = "rab5",
  spot_folder = "rab5_mask",
  n_jobs = NULL
)
}
\arguments{
\item{root_dir}{Character. Path to the root directory containing experimental condition folders.
Each condition folder should contain the subdirectories listed above.}

\item{min_spot_size}{Numeric. Minimum area (in pixels) for Rab spots to include.
Spots smaller than this are filtered out. Default is 8.}

\item{neighbor_radius}{Numeric. Radius (in pixels) for searching neighboring Rab spots.
Default is 15 pixels (considering typical endosome size ~500-1000 nm).}

\item{conditions}{Character vector. Specific experimental conditions to process.
If NULL, all folders in root_dir are processed. Default is NULL.}

\item{python_path}{Character. Path to a Python executable to use. If NULL, uses the
package's managed virtualenv. Default is NULL.}

\item{nucleus_folder}{Character. Name of nucleus mask subfolder. Default "nucleus_mask".}

\item{cell_folder}{Character. Name of cell mask subfolder. Default "cell_mask".}

\item{rab_folder}{Character. Name of Rab signal subfolder. Default "rab5".}

\item{spot_folder}{Character. Name of spot mask subfolder. Default "rab5_mask".}

\item{n_jobs}{Integer. Number of parallel workers for image processing. If NULL,
uses `parallel::detectCores() - 2` (minimum 1). Set to 1 for
serial processing.}
}
\value{
A list of data frames, one for each condition, containing extracted features:
  \describe{
    \item{Cell_label}{ID of the cell analyzed}
    \item{size}{Area of Rab spot in pixels}
    \item{IntegInt}{Sum of pixel intensities within spot}
    \item{MeanInt}{Mean pixel intensity within spot}
    \item{Circ}{Circularity measure (0-1, where 1 is perfect circle)}
    \item{Ecc}{Eccentricity of spot (0-1)}
    \item{Elo}{Ratio of major to minor axis}
    \item{NucleusDist}{Distance from nucleus centroid (normalized by Feret's diameter)}
    \item{NucleusDistOut}{Distance from nucleus outline (normalized by Feret's diameter)}
    \item{PMDist}{Distance from cell plasma membrane (normalized by Feret's diameter)}
    \item{DNN}{Distance to nearest neighboring spot (normalized by Feret's diameter)}
    \item{No}{Number of neighboring spots within radius}
  }
  Each data frame is also saved as a CSV file in the root_dir.
}
\description{
This function performs automated feature extraction from TIFF microscopy images
within a specified folder by calling Python as a subprocess. It processes nucleus masks,
cell masks, Rab raw signals, and spot masks to extract morphological and spatial
features of Rab spots using true multiprocessing with the loky backend.
}
\details{
The function expects a folder structure with subdirectories:
\describe{
  \item{nucleus_mask/}{Folder containing nucleus mask TIFF images}
  \item{cell_mask/}{Folder containing cell mask TIFF images}
  \item{rab5/}{Folder containing raw Rab signal TIFF images}
  \item{rab5_mask/}{Folder containing Rab spot mask TIFF images}
}



This function spawns a Python subprocess using \pkg{processx} that runs the packaged
`feature_extraction_wrapper.py` script. A dedicated virtual environment
(named `"rabanalyser-venv"` by default) is created on-demand if needed,
based on the dependency list in `inst/python/requirements.txt`.

The Python backend uses joblib with the loky multiprocessing backend,
which provides true parallelism for CPU-bound operations.

All distance measures are normalized by Feret's diameter (longest distance across
the cell's convex hull) for scale-invariant comparisons.
}
\examples{
\dontrun{
  # Process all conditions in a directory
  results <- extract_features("/path/to/data/folder")

  # Process specific conditions only
  results <- extract_features("/path/to/data/folder",
                              conditions = c("Control", "Treatment"))

  # Use custom parameters
  results <- extract_features(
    "/path/to/data/folder",
    min_spot_size = 10,
    neighbor_radius = 20
  )

  # Use custom folder names
  results <- extract_features(
    "/path/to/data/folder",
    nucleus_folder = "nucleus",
    cell_folder = "cell",
    rab_folder = "rab_signal",
    spot_folder = "rab_spots"
  )

  # Use parallel processing with 4 workers
  results <- extract_features(
    "/path/to/data/folder",
    n_jobs = 4
  )
}

}
